<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bunutan - Christmas Gift Exchange</title>
    <style>
        :root {
            --primary-color: #C41E3A;
            --primary-dark: #8B1428;
            --success-color: #2ECC71;
            --danger-color: #E74C3C;
            --warning-color: #F39C12;
            --light-bg: #F9F9F9;
            --white: #FFFFFF;
            --text-dark: #2C3E50;
            --text-light: #7F8C8D;
            --border-color: #E0E0E0;
            --gold: #FFD700;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #1A1A1A 0%, #2C3E50 100%);
            color: var(--text-dark);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Navbar */
        .navbar {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: var(--white);
            padding: 1rem 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .navbar-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
        }

        .navbar-brand {
            font-size: 1.8rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            white-space: nowrap;
        }

        .navbar-brand::before {
            content: "üéÑ";
            font-size: 2rem;
        }

        .nav-tabs {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .nav-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: var(--white);
            padding: 0.75rem 1.25rem;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s ease;
            font-size: 0.95rem;
            font-weight: 500;
        }

        .nav-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .nav-btn.active {
            background: var(--gold);
            color: var(--primary-dark);
        }

        /* Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 20px;
        }

        /* Sections */
        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Card Component */
        .card {
            background: var(--white);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem;
            border: 1px solid var(--border-color);
        }

        .card-header {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: var(--primary-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.85rem;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(196, 30, 58, 0.1);
        }

        /* Buttons */
        .btn {
            padding: 0.85rem 1.5rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-block;
        }

        .btn-primary {
            background: var(--primary-color);
            color: var(--white);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(196, 30, 58, 0.4);
        }

        .btn-secondary {
            background: var(--text-light);
            color: var(--white);
        }

        .btn-secondary:hover {
            background: var(--text-dark);
        }

        .btn-danger {
            background: var(--danger-color);
            color: var(--white);
        }

        .btn-danger:hover {
            background: #C0392B;
        }

        .btn-success {
            background: var(--success-color);
            color: var(--white);
        }

        .btn-success:hover {
            background: #27AE60;
        }

        .btn-small {
            padding: 0.6rem 1rem;
            font-size: 0.9rem;
        }

        /* Grid Layout */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: var(--white);
            padding: 2rem;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 6px 20px rgba(196, 30, 58, 0.3);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.95rem;
            opacity: 0.95;
        }

        /* Table */
        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .table thead {
            background: var(--light-bg);
        }

        .table th {
            padding: 1.2rem;
            text-align: left;
            font-weight: 700;
            border-bottom: 3px solid var(--border-color);
            color: var(--text-dark);
        }

        .table td {
            padding: 1rem 1.2rem;
            border-bottom: 1px solid var(--border-color);
        }

        .table tbody tr:hover {
            background: #F0F0F0;
        }

        /* Badge */
        .badge {
            display: inline-block;
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .badge-success {
            background: rgba(46, 204, 113, 0.15);
            color: var(--success-color);
        }

        .badge-warning {
            background: rgba(243, 156, 18, 0.15);
            color: var(--warning-color);
        }

        .badge-danger {
            background: rgba(231, 76, 60, 0.15);
            color: var(--danger-color);
        }

        .badge-primary {
            background: rgba(196, 30, 58, 0.15);
            color: var(--primary-color);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--white);
            border-radius: 12px;
            padding: 2.5rem;
            width: 90%;
            max-width: 550px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .modal-header {
            font-size: 1.6rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--primary-color);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: var(--text-light);
            transition: color 0.3s;
        }

        .modal-close:hover {
            color: var(--primary-color);
        }

        /* Gift Card */
        .gift-card {
            background: linear-gradient(135deg, #fff8dc 0%, #fffacd 100%);
            border: 2px solid var(--gold);
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 12px rgba(255, 215, 0, 0.2);
        }

        .gift-card-recipient {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .gift-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .detail-item {
            background: var(--white);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }

        .detail-label {
            font-size: 0.85rem;
            color: var(--text-light);
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: 0.25rem;
        }

        .detail-value {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--text-dark);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .navbar-container {
                flex-direction: column;
                gap: 1rem;
            }

            .nav-tabs {
                width: 100%;
                justify-content: center;
            }

            .nav-btn {
                flex: 1;
                min-width: 100px;
                font-size: 0.85rem;
            }

            .card {
                padding: 1.5rem;
            }

            .card-header {
                font-size: 1.25rem;
                flex-direction: column;
                align-items: flex-start;
            }

            .grid {
                grid-template-columns: 1fr;
            }

            .table {
                font-size: 0.9rem;
            }

            .table th,
            .table td {
                padding: 0.75rem;
            }

            .modal-content {
                padding: 1.5rem;
                width: 95%;
            }
        }

        /* Utility */
        .mt-1 { margin-top: 1rem; }
        .mt-2 { margin-top: 2rem; }
        .mb-1 { margin-bottom: 1rem; }
        .mb-2 { margin-bottom: 2rem; }
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .text-muted { color: var(--text-light); }
        .success-text { color: var(--success-color); }
        .danger-text { color: var(--danger-color); }

        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        @media (max-width: 768px) {
            .two-column {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-container">
            <div class="navbar-brand">Bunutan</div>
            <div class="nav-tabs">
                <button class="nav-btn active" onclick="switchTab('home')">üè† Home</button>
                <button class="nav-btn" onclick="switchTab('participant')">üéÅ My Gift</button>
                <button class="nav-btn" onclick="switchTab('admin')">‚öôÔ∏è Admin</button>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container">
        <!-- Home Section -->
        <div id="home" class="section active">
            <div class="card text-center">
                <div class="card-header" style="justify-content: center;">
                    üéÑ Bunutan - Christmas Gift Exchange üéÑ
                </div>
                <p style="font-size: 1.1rem; margin-bottom: 1.5rem; color: var(--text-light);">
                    A magical way to organize your Secret Santa gift exchange!
                </p>
                <div class="grid" style="margin-top: 2rem;">
                    <button class="stat-card" onclick="switchTab('participant')" style="cursor: pointer; border: none; transition: transform 0.3s; padding: 2.5rem;">
                        <div style="font-size: 3rem; margin-bottom: 0.5rem;">üéÅ</div>
                        <div class="stat-label" style="font-size: 1rem;">Find My Gift</div>
                        <p style="font-size: 0.9rem; margin-top: 0.5rem; opacity: 0.9;">See who I'm buying for</p>
                    </button>
                    <button class="stat-card" onclick="switchTab('admin')" style="cursor: pointer; border: none; transition: transform 0.3s; padding: 2.5rem;">
                        <div style="font-size: 3rem; margin-bottom: 0.5rem;">üëë</div>
                        <div class="stat-label" style="font-size: 1rem;">Admin Panel</div>
                        <p style="font-size: 0.9rem; margin-top: 0.5rem; opacity: 0.9;">Manage the exchange</p>
                    </button>
                </div>
            </div>

            <div class="card">
                <div class="card-header">‚ú® Features</div>
                <div class="grid">
                    <div style="text-align: center; padding: 1.5rem;">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üé≤</div>
                        <strong>Random Assignment</strong>
                        <p style="color: var(--text-light); font-size: 0.9rem; margin-top: 0.5rem;">Automatic Secret Santa pairing</p>
                    </div>
                    <div style="text-align: center; padding: 1.5rem;">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üí∞</div>
                        <strong>Budget Management</strong>
                        <p style="color: var(--text-light); font-size: 0.9rem; margin-top: 0.5rem;">Set and track spending limits</p>
                    </div>
                    <div style="text-align: center; padding: 1.5rem;">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üìù</div>
                        <strong>Wishlists</strong>
                        <p style="color: var(--text-light); font-size: 0.9rem; margin-top: 0.5rem;">Share gift preferences</p>
                    </div>
                    <div style="text-align: center; padding: 1.5rem;">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">‚úÖ</div>
                        <strong>Track Status</strong>
                        <p style="color: var(--text-light); font-size: 0.9rem; margin-top: 0.5rem;">Monitor purchase progress</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Participant View -->
        <div id="participant" class="section">
            <div class="card">
                <div class="card-header">
                    üéÅ My Secret Santa Assignment
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        <select id="participantSelector" onchange="switchParticipant()" style="padding: 0.6rem 1rem; border-radius: 6px; border: 2px solid var(--border-color); font-weight: 600;">
                            <option value="">Select Your Name...</option>
                        </select>
                        <button class="btn btn-primary btn-small" onclick="openModal('wislistModal')">üìù Update Wishlist</button>
                    </div>
                </div>

                <div id="assignmentContainer" style="display: none;">
                    <div class="gift-card">
                        <div style="text-align: center; margin-bottom: 1rem;">
                            <div style="font-size: 3rem;">üéâ</div>
                        </div>
                        <div class="gift-card-recipient">
                            I'm buying for: <span id="recipientName" style="color: var(--primary-color);">Loading...</span>
                        </div>
                        <div class="gift-details">
                            <div class="detail-item">
                                <div class="detail-label">Budget</div>
                                <div class="detail-value">‚Ç±<span id="recipientBudget">0</span></div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Exchange Date</div>
                                <div class="detail-value" id="exchangeDate">TBD</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Status</div>
                                <div class="detail-value">
                                    <span class="badge badge-warning" id="purchaseStatus">Not Purchased</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-group mt-2">
                            <label>üìÑ Their Wishlist</label>
                            <div style="background: var(--light-bg); padding: 1rem; border-radius: 6px; min-height: 80px;" id="wishlistDisplay">
                                <p class="text-muted text-center">No wishlist provided yet</p>
                            </div>
                        </div>

                        <div class="two-column mt-2">
                            <button class="btn btn-success" onclick="markPurchased()">‚úì Mark as Purchased</button>
                            <button class="btn btn-secondary" onclick="resetStatus()">‚Üª Reset Status</button>
                        </div>
                    </div>
                </div>

                <div id="noAssignmentContainer" style="text-align: center; padding: 2rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">‚ùì</div>
                    <p class="text-muted" style="font-size: 1.1rem;">No assignment yet. Admin needs to generate assignments first!</p>
                </div>
            </div>

            <div class="card">
                <div class="card-header">My Wishlist</div>
                <div id="myWishlistDisplay" style="background: var(--light-bg); padding: 1.5rem; border-radius: 8px; min-height: 100px;">
                    <p class="text-muted text-center">No wishlist created yet. Click the button above to add one!</p>
                </div>
            </div>
        </div>

        <!-- Admin Panel -->
        <div id="admin" class="section">
            <div class="card">
                <div class="card-header">
                    üëë Admin Dashboard
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        <button class="btn btn-primary btn-small" onclick="openModal('participantModal')">‚ûï Add Participant</button>
                        <button class="btn btn-success btn-small" onclick="generateAssignments()">üé≤ Generate Assignments</button>
                    </div>
                </div>

                <div class="grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalParticipants">0</div>
                        <div class="stat-label">Total Participants</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="assignmentStatus">0</div>
                        <div class="stat-label">Paired</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="purchasedCount">0</div>
                        <div class="stat-label">Purchased</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    Exchange Settings
                    <button class="btn btn-secondary btn-small" onclick="openModal('settingsModal')">‚öôÔ∏è Edit Settings</button>
                </div>

                <div class="two-column">
                    <div>
                        <label style="font-weight: 600; display: block; margin-bottom: 0.5rem;">üí∞ Budget Limit</label>
                        <input type="number" id="budgetDisplay" disabled style="background: var(--light-bg);" value="0">
                    </div>
                    <div>
                        <label style="font-weight: 600; display: block; margin-bottom: 0.5rem;">üìÖ Exchange Date</label>
                        <input type="text" id="exchangeDateDisplay" disabled style="background: var(--light-bg);" value="Not Set">
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">Manage Participants</div>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Assigned To</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="participantTableBody">
                        <tr>
                            <td colspan="5" class="text-center text-muted">No participants yet. Add one to get started!</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="card">
                <div class="card-header">Secret Santa Pairings</div>
                <div id="pairingsContainer">
                    <p class="text-muted text-center" style="padding: 2rem;">No assignments generated yet. Click "Generate Assignments" above!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Participant Modal -->
    <div id="participantModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                ‚ûï Add Participant
                <button class="modal-close" onclick="closeModal('participantModal')">&times;</button>
            </div>
            <div class="form-group">
                <label>Full Name</label>
                <input type="text" id="participantName" placeholder="e.g., Juan Dela Cruz">
            </div>
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="participantEmail" placeholder="e.g., juan@example.com">
            </div>
            <button class="btn btn-primary" onclick="addParticipant()" style="width: 100%;">Add Participant</button>
        </div>
    </div>

    <!-- Wishlist Modal -->
    <div id="wislistModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                üìù My Wishlist
                <button class="modal-close" onclick="closeModal('wislistModal')">&times;</button>
            </div>
            <div class="form-group">
                <label>What would you like to receive? (One item per line)</label>
                <textarea id="wishlistInput" rows="6" placeholder="Example:&#10;- Blue T-shirt (Size M)&#10;- Coffee maker&#10;- Book: &quot;Your Favorite&quot;&#10;- Chocolate assortment"></textarea>
            </div>
            <button class="btn btn-primary" onclick="saveWishlist()" style="width: 100%; margin-bottom: 0.5rem;">Save Wishlist</button>
            <button class="btn btn-secondary" onclick="closeModal('wislistModal')" style="width: 100%;">Close</button>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                ‚öôÔ∏è Exchange Settings
                <button class="modal-close" onclick="closeModal('settingsModal')">&times;</button>
            </div>
            <div class="form-group">
                <label>Budget Limit (‚Ç±)</label>
                <input type="number" id="budgetInput" min="0" step="100" placeholder="e.g., 1000">
            </div>
            <div class="form-group">
                <label>Exchange Date</label>
                <input type="date" id="exchangeDateInput">
            </div>
            <button class="btn btn-primary" onclick="saveSettings()" style="width: 100%;">Save Settings</button>
        </div>
    </div>

    <script>
        // Storage Keys
        const STORAGE_PARTICIPANTS = 'bunutan_participants';
        const STORAGE_ASSIGNMENTS = 'bunutan_assignments';
        const STORAGE_WISHLISTS = 'bunutan_wishlists';
        const STORAGE_SETTINGS = 'bunutan_settings';
        const STORAGE_USER_ID = 'bunutan_user_id';

        // Initialize App
        function initApp() {
            try {
                loadSettings();
                loadParticipants();
                loadParticipantSelector();
                updateAdminDashboard();
                loadUserAssignment();
            } catch (error) {
                console.error('Error initializing app:', error);
                alert('Error initializing app. Please refresh the page.');
            }
        }

        // Tab Switching
        function switchTab(tabName) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Modal Management
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Settings Management
        function loadSettings() {
            try {
                const settings = JSON.parse(localStorage.getItem(STORAGE_SETTINGS)) || {
                    budget: 1000,
                    exchangeDate: '2025-12-25'
                };
                
                const budget = parseInt(settings.budget) || 1000;
                const exchangeDate = settings.exchangeDate || '2025-12-25';
                
                document.getElementById('budgetDisplay').value = budget;
                document.getElementById('budgetInput').value = budget;
                document.getElementById('exchangeDateDisplay').value = exchangeDate;
                document.getElementById('exchangeDateInput').value = exchangeDate;
            } catch (error) {
                console.error('Error loading settings:', error);
                document.getElementById('budgetDisplay').value = 1000;
                document.getElementById('budgetInput').value = 1000;
                document.getElementById('exchangeDateDisplay').value = '2025-12-25';
                document.getElementById('exchangeDateInput').value = '2025-12-25';
            }
        }

        function saveSettings() {
            try {
                const budgetInput = document.getElementById('budgetInput').value.trim();
                const exchangeDateInput = document.getElementById('exchangeDateInput').value.trim();

                if (!budgetInput || !exchangeDateInput) {
                    alert('Please fill all fields with valid values');
                    return;
                }

                const budget = parseInt(budgetInput);
                
                if (isNaN(budget) || budget < 0) {
                    alert('Please enter a valid budget amount');
                    return;
                }

                if (!exchangeDateInput.match(/^\d{4}-\d{2}-\d{2}$/)) {
                    alert('Please select a valid date');
                    return;
                }

                const settings = { 
                    budget: budget, 
                    exchangeDate: exchangeDateInput 
                };
                
                localStorage.setItem(STORAGE_SETTINGS, JSON.stringify(settings));
                loadSettings();
                closeModal('settingsModal');
                alert('Settings updated successfully!');
            } catch (error) {
                console.error('Error saving settings:', error);
                alert('Error saving settings. Please try again.');
            }
        }

        // Participant Management
        function addParticipant() {
            const name = document.getElementById('participantName').value.trim();
            const email = document.getElementById('participantEmail').value.trim();

            if (!name || !email) {
                alert('Please fill all fields');
                return;
            }

            const participants = JSON.parse(localStorage.getItem(STORAGE_PARTICIPANTS)) || [];
            const participant = {
                id: Date.now(),
                name,
                email,
                joinDate: new Date().toLocaleDateString()
            };

            participants.push(participant);
            localStorage.setItem(STORAGE_PARTICIPANTS, JSON.stringify(participants));

            closeModal('participantModal');
            loadParticipants();
            updateAdminDashboard();
            alert('Participant added successfully!');
            document.getElementById('participantName').value = '';
            document.getElementById('participantEmail').value = '';
        }

        function deleteParticipant(id) {
            if (!confirm('Are you sure? This will also delete any assignments.')) return;
            
            let participants = JSON.parse(localStorage.getItem(STORAGE_PARTICIPANTS)) || [];
            let assignments = JSON.parse(localStorage.getItem(STORAGE_ASSIGNMENTS)) || [];
            
            participants = participants.filter(p => p.id !== id);
            assignments = assignments.filter(a => a.fromId !== id && a.toId !== id);
            
            localStorage.setItem(STORAGE_PARTICIPANTS, JSON.stringify(participants));
            localStorage.setItem(STORAGE_ASSIGNMENTS, JSON.stringify(assignments));
            
            loadParticipants();
            updateAdminDashboard();
        }

        function loadParticipants() {
            const participants = JSON.parse(localStorage.getItem(STORAGE_PARTICIPANTS)) || [];
            const assignments = JSON.parse(localStorage.getItem(STORAGE_ASSIGNMENTS)) || [];
            const tbody = document.getElementById('participantTableBody');

            if (participants.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="text-center text-muted">No participants yet. Add one to get started!</td></tr>';
                return;
            }

            tbody.innerHTML = participants.map(p => {
                const assignment = assignments.find(a => a.fromId === p.id);
                const assignedTo = assignment ? participants.find(pa => pa.id === assignment.toId)?.name : 'Not assigned';
                const statusBadge = assignment ? '<span class="badge badge-success">‚úì Assigned</span>' : '<span class="badge badge-warning">‚è≥ Pending</span>';
                
                return `
                    <tr>
                        <td>${p.name}</td>
                        <td>${p.email}</td>
                        <td>${assignedTo}</td>
                        <td>${statusBadge}</td>
                        <td>
                            <button class="btn btn-danger btn-small" onclick="deleteParticipant(${p.id})">Delete</button>
                        </td>
                    </tr>
                `;
            }).join('');

            document.getElementById('totalParticipants').textContent = participants.length;
            loadParticipantSelector();
        }

        // Assignment Management
        function generateAssignments() {
            const participants = JSON.parse(localStorage.getItem(STORAGE_PARTICIPANTS)) || [];
            
            if (participants.length < 2) {
                alert('You need at least 2 participants to generate assignments');
                return;
            }

            if (!confirm(`Generate Secret Santa assignments for ${participants.length} participants?`)) return;

            const shuffled = [...participants].sort(() => Math.random() - 0.5);
            const assignments = [];

            for (let i = 0; i < shuffled.length; i++) {
                const nextIndex = (i + 1) % shuffled.length;
                assignments.push({
                    fromId: shuffled[i].id,
                    toId: shuffled[nextIndex].id,
                    purchased: false
                });
            }

            localStorage.setItem(STORAGE_ASSIGNMENTS, JSON.stringify(assignments));
            loadParticipants();
            updateAdminDashboard();
            displayPairings();
            alert('Assignments generated successfully! üéÑ');
        }

        function displayPairings() {
            const participants = JSON.parse(localStorage.getItem(STORAGE_PARTICIPANTS)) || [];
            const assignments = JSON.parse(localStorage.getItem(STORAGE_ASSIGNMENTS)) || [];
            const container = document.getElementById('pairingsContainer');

            if (assignments.length === 0) {
                container.innerHTML = '<p class="text-muted text-center" style="padding: 2rem;">No assignments generated yet.</p>';
                return;
            }

            container.innerHTML = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>üéÖ From (Secret Santa)</th>
                            <th>‚Üí</th>
                            <th>üéÅ To (Recipient)</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${assignments.map(a => {
                            const from = participants.find(p => p.id === a.fromId);
                            const to = participants.find(p => p.id === a.toId);
                            const status = a.purchased ? '<span class="badge badge-success">‚úì Purchased</span>' : '<span class="badge badge-warning">‚è≥ Pending</span>';
                            return `
                                <tr>
                                    <td>${from?.name || 'Unknown'}</td>
                                    <td style="text-align: center;">‚Üí</td>
                                    <td>${to?.name || 'Unknown'}</td>
                                    <td>${status}</td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            `;
        }

        function updateAdminDashboard() {
            const participants = JSON.parse(localStorage.getItem(STORAGE_PARTICIPANTS)) || [];
            const assignments = JSON.parse(localStorage.getItem(STORAGE_ASSIGNMENTS)) || [];
            
            document.getElementById('assignmentStatus').textContent = assignments.length;
            document.getElementById('purchasedCount').textContent = assignments.filter(a => a.purchased).length;
            
            displayPairings();
        }

        // Participant Selector Dropdown
        function loadParticipantSelector() {
            const participants = JSON.parse(localStorage.getItem(STORAGE_PARTICIPANTS)) || [];
            const selector = document.getElementById('participantSelector');
            
            selector.innerHTML = '<option value="">Select Your Name...</option>';
            
            participants.forEach(p => {
                const option = document.createElement('option');
                option.value = p.id;
                option.textContent = p.name;
                selector.appendChild(option);
            });

            const userId = JSON.parse(localStorage.getItem(STORAGE_USER_ID));
            if (userId) {
                selector.value = userId;
            }
        }

        function switchParticipant() {
            const selector = document.getElementById('participantSelector');
            const userId = selector.value;

            if (!userId) {
                document.getElementById('assignmentContainer').style.display = 'none';
                document.getElementById('noAssignmentContainer').style.display = 'block';
                document.getElementById('noAssignmentContainer').innerHTML = '<div style="text-align: center; padding: 2rem;"><div style="font-size: 3rem; margin-bottom: 1rem;">üë§</div><p class="text-muted" style="font-size: 1.1rem;">Please select your name from the dropdown above</p></div>';
                return;
            }

            localStorage.setItem(STORAGE_USER_ID, JSON.stringify(parseInt(userId)));
            loadUserAssignment();
        }

        // User Assignment View
        function loadUserAssignment() {
            const userId = JSON.parse(localStorage.getItem(STORAGE_USER_ID)) || null;
            const participants = JSON.parse(localStorage.getItem(STORAGE_PARTICIPANTS)) || [];
            const assignments = JSON.parse(localStorage.getItem(STORAGE_ASSIGNMENTS)) || [];
            const settings = JSON.parse(localStorage.getItem(STORAGE_SETTINGS)) || { budget: 1000, exchangeDate: '2025-12-25' };

            if (!userId || !participants.find(p => p.id === userId)) {
                document.getElementById('assignmentContainer').style.display = 'none';
                document.getElementById('noAssignmentContainer').style.display = 'block';
                document.getElementById('noAssignmentContainer').innerHTML = '<div style="text-align: center; padding: 2rem;"><div style="font-size: 3rem; margin-bottom: 1rem;">üë§</div><p class="text-muted" style="font-size: 1.1rem;">Please select your name from the dropdown above</p></div>';
                return;
            }

            const userAssignment = assignments.find(a => a.fromId === userId);
            const assignmentContainer = document.getElementById('assignmentContainer');
            const noAssignmentContainer = document.getElementById('noAssignmentContainer');

            if (!userAssignment) {
                assignmentContainer.style.display = 'none';
                noAssignmentContainer.style.display = 'block';
                noAssignmentContainer.innerHTML = '<div style="text-align: center; padding: 2rem;"><div style="font-size: 3rem; margin-bottom: 1rem;">‚ùì</div><p class="text-muted" style="font-size: 1.1rem;">No assignment yet. Admin needs to generate assignments first!</p></div>';
                return;
            }

            const recipient = participants.find(p => p.id === userAssignment.toId);
            if (!recipient) return;

            assignmentContainer.style.display = 'block';
            noAssignmentContainer.style.display = 'none';

            document.getElementById('recipientName').textContent = recipient.name;
            document.getElementById('recipientBudget').textContent = settings.budget;
            document.getElementById('exchangeDate').textContent = settings.exchangeDate;
            document.getElementById('purchaseStatus').textContent = userAssignment.purchased ? '‚úì Purchased' : '‚è≥ Not Purchased';
            document.getElementById('purchaseStatus').className = userAssignment.purchased ? 'badge badge-success' : 'badge badge-warning';

            loadWishlists();
        }

        // Wishlist Management
        function saveWishlist() {
            const userId = JSON.parse(localStorage.getItem(STORAGE_USER_ID));
            const wishlist = document.getElementById('wishlistInput').value.trim();

            if (!wishlist) {
                alert('Please add at least one item to your wishlist');
                return;
            }

            const wishlists = JSON.parse(localStorage.getItem(STORAGE_WISHLISTS)) || {};
            wishlists[userId] = wishlist;
            localStorage.setItem(STORAGE_WISHLISTS, JSON.stringify(wishlists));

            closeModal('wislistModal');
            loadWishlists();
            alert('Wishlist saved successfully! üéÅ');
        }

        function loadWishlists() {
            const userId = JSON.parse(localStorage.getItem(STORAGE_USER_ID));
            const wishlists = JSON.parse(localStorage.getItem(STORAGE_WISHLISTS)) || {};
            const userWishlist = wishlists[userId] || '';
            const assignments = JSON.parse(localStorage.getItem(STORAGE_ASSIGNMENTS)) || [];
            const participants = JSON.parse(localStorage.getItem(STORAGE_PARTICIPANTS)) || [];

            // My wishlist
            const myWishlistDisplay = document.getElementById('myWishlistDisplay');
            if (userWishlist) {
                const items = userWishlist.split('\n').filter(item => item.trim());
                myWishlistDisplay.innerHTML = `
                    <ul style="list-style-position: inside; line-height: 2;">
                        ${items.map(item => `<li>${item.trim()}</li>`).join('')}
                    </ul>
                `;
            } else {
                myWishlistDisplay.innerHTML = '<p class="text-muted text-center">No wishlist created yet.</p>';
            }

            // Recipient wishlist
            const userAssignment = assignments.find(a => a.fromId === userId);
            if (userAssignment) {
                const recipientWishlist = wishlists[userAssignment.toId] || '';
                const wishlistDisplay = document.getElementById('wishlistDisplay');
                if (recipientWishlist) {
                    const items = recipientWishlist.split('\n').filter(item => item.trim());
                    wishlistDisplay.innerHTML = `
                        <ul style="list-style-position: inside; line-height: 2;">
                            ${items.map(item => `<li>${item.trim()}</li>`).join('')}
                        </ul>
                    `;
                } else {
                    wishlistDisplay.innerHTML = '<p class="text-muted text-center">No wishlist provided yet</p>';
                }
            }

            // Load textarea
            document.getElementById('wishlistInput').value = userWishlist;
        }

        function markPurchased() {
            const userId = JSON.parse(localStorage.getItem(STORAGE_USER_ID));
            let assignments = JSON.parse(localStorage.getItem(STORAGE_ASSIGNMENTS)) || [];
            const assignment = assignments.find(a => a.fromId === userId);

            if (!assignment) return;

            assignment.purchased = true;
            localStorage.setItem(STORAGE_ASSIGNMENTS, JSON.stringify(assignments));
            loadUserAssignment();
            updateAdminDashboard();
            alert('Great! You marked your gift as purchased! üéâ');
        }

        function resetStatus() {
            const userId = JSON.parse(localStorage.getItem(STORAGE_USER_ID));
            let assignments = JSON.parse(localStorage.getItem(STORAGE_ASSIGNMENTS)) || [];
            const assignment = assignments.find(a => a.fromId === userId);

            if (!assignment) return;

            assignment.purchased = false;
            localStorage.setItem(STORAGE_ASSIGNMENTS, JSON.stringify(assignments));
            loadUserAssignment();
            updateAdminDashboard();
        }

        // Initialize on load
        window.addEventListener('load', initApp);

        // Handle navigation and modals
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('nav-btn')) {
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');
            }
        });

        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
            });
        });
    </script>
</body>
</html>
